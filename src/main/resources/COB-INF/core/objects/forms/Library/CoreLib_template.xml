<?xml version="1.0"?>
<jx:template xmlns:jx="http://apache.org/cocoon/templates/jx/1.0"
             xmlns:ft="http://apache.org/cocoon/forms/1.0#template"
             xmlns:fi="http://apache.org/cocoon/forms/1.0#instance"
             xmlns:i18n="http://apache.org/cocoon/i18n/2.1">

    <jx:import uri="servlet:forms:/resource/internal/generation/jx-macros.xml"/>

    <jx:macro name="form-template" targetNamespace="http://apache.org/cocoon/forms/1.0#template">
        <jx:parameter name="location"/>

        <jx:set var="localeSitemapParameter" value="${cocoon.parameters.getParameter('locale', '')}"/>
        <jx:set var="cformsHelper"
                value="#{org.apache.cocoon.forms.generation.JXMacrosHelper.createHelper($cocoon/consumer,$cocoon/request,$localeSitemapParameter)}"/>
        <jx:set var="attributeName" value="${cocoon.parameters['attribute-name']}"/>
        <jx:choose>
            <jx:when test="${attributeName and attributeName.length() > 0}">
                <jx:set var="form" value="${cformsHelper.getForm(null, attributeName)}"/>
            </jx:when>
            <jx:when test="${location}">
                <jx:set var="var" value="${macro.arguments.remove('location')}"/>
                <jx:set var="form" value="${cformsHelper.getForm(location, attributeName)}"/>
            </jx:when>
            <jx:otherwise>
                <jx:set var="form" value="${cformsHelper.getForm(CocoonFormsInstance, attributeName)}"/>
            </jx:otherwise>
        </jx:choose>

        <jx:if test="${form != null and cformsHelper.isVisible(form)}">
            <jx:set var="cformsDummy" value="${cformsHelper.startForm(form, macro.arguments)}"/>
            <!--  the form is also the current widget
            -->
            <jx:set var="widget" value="${form}"/>
            <jx:evalBody/>
            <jx:set var="cformsDummy" value="${cformsHelper.endForm()}"/>
        </jx:if>
    </jx:macro>


    <jx:macro name="justName">
        <ft:group id="justName">
            <li>
                <label title="name" for="name" class="label">
                    <ft:widget-label id="name"/>
                </label>
                <ft:widget id="name">
                    <fi:styling size="50"/>
                </ft:widget>

            </li>
        </ft:group>
    </jx:macro>

    <jx:macro name="systemURL">
        <ft:group id="systemURL">
            <li>
                <label title="name" for="name" class="label">
                    <ft:widget-label id="name"/>
                </label>
                <ft:widget id="name">
                    <fi:styling size="50"/>
                </ft:widget>
                <!--<ft:widget id="id">
                    <fi:styling type="hidden"/>
                </ft:widget>-->
            </li>
            <li>
                <label for="systemName" class="label">
                    <ft:widget-label id="systemName"/>
                </label>
                <ft:widget id="systemName">
                    <fi:styling size="45"/>
                </ft:widget>

                <ft:widget id="checkSystemName"/>

            </li>
        </ft:group>
    </jx:macro>
    <jx:macro name="translate">

        <div class="punto"/>
        <script type="text/javascript">
            function changeLocale(languageCode){
            $("div.meta-info").hide();
            var targetDivName ='translate_'+languageCode;
            '*[name= targetDivName]'
            $('*[name='+ targetDivName+']').show();
            <!--var newFormLocale = document.getElementById('translate');-->
            var newFormLocale = document.getElementById('formLocale');
            newFormLocale.value = languageCode;

            if(document.getElementById('documentForm') != null){
            submitAll(languageCode);
            }else{
            cocoon.forms.submitForm(newFormLocale);
            }
            <!--if(cocoon.session.getAttribute("languageCode")){

            }-->

            <!--cocoon.forms.submitForm(dynamicForm);-->

            <!--var dynamicForm = document.getElementById('dynamicForm');-->
            <!--submit DocType-->
            var documentTypeForm =document.getElementById('dynamicForm');
            if(documentTypeForm != null){
            <!--cocoon.forms.submitForm(documentTypeForm);-->
            <!--cocoon.forms.submitForm(contentForm);-->
            <!--cocoon.forms.submitForm(documentTypeForm);-->
            <!--cocoon.forms.submitForm(all);-->
            }
            }
        </script>

        <ft:widget id="translate">
            <!--<fi:styling class="chzn-select" style="width:350px;" onChange="changeLocale(this.value);"/>-->
            <fi:styling class="chzn-select" style="width:350px;" onChange="changeLocale(this.value);"/>
            <fi:selection-list>

                <jx:forEach items="${availableLanguages}" var="language">
                    <fi:item value="${language.code}">
                        <fi:label>${language.name}</fi:label>
                    </fi:item>
                </jx:forEach>
            </fi:selection-list>
        </ft:widget>

        <script type="text/javascript">
            $(".chzn-select").chosen();
        </script>
        <ft:widget id="formLocale">
            <fi:styling type="hidden"/>
        </ft:widget>

    </jx:macro>
    <jx:macro name="emsFields">
        <jx:parameter name="entity"/>
        <jx:parameter name="id"/>
        <jx:parameter name="parentId" default="0"/>
        <jx:parameter name="parentName" default=""/>
        <jx:parameter name="showParents" default="0"/>
        <jx:set var="attributeName" value="${cocoon.parameters['attribute-name']}"/>
        <ul class="simple-list">
            <jx:if test="${showParents == 1}">
                <li>
                    <label title="" for="parentName" class="label">
                        <i18n:text key="EmsObject.parentElement"/>
                    </label>

                    <span id="parentName">
                        <jx:choose>
                            <jx:when test="${parentId > 0}">
                                <a href="${entity}-edit?id=${parentId}">${parentName}</a>
                            </jx:when>
                            <jx:otherwise>
                                <i18n:text key="EmsObject.noParentElement"/>
                            </jx:otherwise>
                        </jx:choose>
                    </span>
                    <!--<h1>ID:${id}</h1>-->
                    <span align="right" width="300px">
                        <input type="button" i18n:attr="value" value="Modify" onclick="openParentDialog(${id})"/>
                        <ft:widget id="parentId">
                            <fi:styling type="hidden"/>
                        </ft:widget>
                    </span>
                </li>

                <script type="text/javascript">
                    var noParentLabel = '!<i18n:text key="EmsObject.noParentElement"/>';

                    function openParentDialog(thisId) {
                    $("#parentTreeContainer:ui-dialog").dialog("destroy");
                    $("#parentTreeContainer").dialog({
                    width: 800,
                    height:400,
                    modal: true,
                    buttons: {
                    "<i18n:text key="Save"/>": function() {
                    $(this).dialog("close");
                    }
                    }
                    });


                    var divId = "#parentTree";
                    var entity = "${entity}";
                    if (entity =='FileObject'){
                    entity ='Folder'
                    }
                    var ajaxUrl;
                    if(thisId > 0){
                    ajaxUrl = "/ems/core/treeObjects?entity="+entity+"&amp;excludedId="+thisId;
                    }
                    else{
                    ajaxUrl = "/ems/core/treeObjects?entity="+entity;
                    }


                    document.getElementById('parentTreeRootNode').value=0;
                    document.getElementById('parentTreeRootNode').innerHTML=entity;
                    initXmlTree(divId, ajaxUrl);

                    $("#parentTreeRootNode").click( function () {
                    updateParentData(noParentLabel,0);
                    });
                    $("#parentTree").click(function (e) {
                    var f = jQuery.jstree._focused();
                    var id = f.data.ui.selected.attr("id");
                    var name = f.data.ui.selected.attr("name");
                    updateParentData(name,id);
                    });

                    function updateParentData(name,id){

                    document.getElementById('parentId').value = id;
                    document.getElementById('parentName').innerHTML =name;
                    cocoon.forms.submitForm(document.getElementById('parentId'));
                    };
                    };

                </script>

                <div i18n:attr="title" title="core:Content.choose" id="parentTreeContainer" class="dialogContent">
                    <div class="common-div">
                        <span class="ui-icon-home"/>
                        <a id="parentTreeRootNode" href="#" class="">HOME</a>
                    </div>
                    <div id="parentTree"/>
                </div>

            </jx:if>
            <jx:choose>
                <jx:when test="${showParents == 1}">
                    <systemURL/>
                </jx:when>
                <jx:otherwise>
                    <justName/>
                </jx:otherwise>
            </jx:choose>
            <lables/>

            <objectRows/>
        </ul>


    </jx:macro>

    <jx:macro name="userDataMacro">
        <userData name="${userData.name}" id="${userData.id}"/>
    </jx:macro>


    <jx:macro name="parentObjects">
        <parents>
            <jx:forEach items="${parents}" var="parent" varStatus="status">
                <parent id="${parent.id}">
                    <name>${parent.name}</name>
                </parent>
            </jx:forEach>
        </parents>
    </jx:macro>


    <jx:macro name="metaInfo">
        <tags/>
        <!-- <jx:forEach items="${availableTags}" var="tag">
           ${tag.tag}
        </jx:forEach>-->

        <ft:repeater id="metaInfo">

            <ft:repeater-rows>
                <jx:set var="rowLanguageCode"
                        value="${repeater.getRow(repeaterLoop.index).getChild('languageCode').value}"/>
                <!--<ft:group id="metaInfo">-->

                <div class="meta-info" name="translate_${rowLanguageCode}">
                    <jx:attribute name="style">
                        <jx:choose>
                            <jx:when test="${rowLanguageCode == formLocale}">
                                display:block;
                            </jx:when>
                            <jx:otherwise>
                                display:none;
                            </jx:otherwise>
                        </jx:choose>

                    </jx:attribute>
                    <!--<ft:widget id="id">
                        <fi:styling type="hidden"/>
                    </ft:widget>-->
                    <ft:widget id="languageCode">
                        <fi:styling type="hidden"/>
                    </ft:widget>
                    <ft:widget id="objectId">
                        <fi:styling type="hidden"/>
                    </ft:widget>

                    <ul class="simple-list">
                        <li>
                            <!--   <script type="text/javascript">
                                <![CDATA[
                        var metaTitle = document.getElementById("title");
                        var contentName = document.getElementById("name");
                        if (metaTitle.value == ''){
                                metaTitle.value = contentName.value;
                            }
                        ]]>
                            </script>-->
                            <label for="title" class="label">
                                <ft:widget-label id="title"/>
                            </label>
                            <ft:widget id="title">
                                <fi:styling size="50"/>
                            </ft:widget>
                        </li>
                        <li>
                            <label for="description" class="label">
                                <ft:widget-label id="description"/>
                            </label>
                            <ft:widget id="description">
                                <fi:styling cols="50" type="textarea" rows="5"/>
                            </ft:widget>
                        </li>
                        <li>
                            <label for="keywords" class="label">
                                <ft:widget-label id="keywords"/>
                            </label>
                            <ft:widget id="keywords">
                                <fi:styling cols="50" type="textarea" rows="3"/>
                            </ft:widget>
                        </li>
                        <li>
                            <!-- <script type="text/javascript">
                                 function addTag(item){
                                 $("#tags").tagEditorAddTag(item);
                                 }
                                 $(document).ready(function() {

                                 $("#tags").tagEditor({
                                 confirmRemovalText: "<i18n:text catalogue="core" key="Tag.confirmRemoval"/>",
                                 confirmRemoval: true,
                                 continuousOutputBuild: true
                                 });


                                 });
                             </script>-->
                            <jx:set var="rowIndex" value="${repeaterLoop.index}"/>


                            <!--<script type="text/javascript">
                                function addTag(item){
                                var rowTag = document.getElementById("metaInfo.${repeaterLoop.index}.tags");
                                    $(rowTag).tagEditorAddTag(item);
                                }
                                $(document).ready(function() {
                                 var rowTag = document.getElementById("metaInfo.${repeaterLoop.index}.tags");
                                $(rowTag).tagEditor({
                                confirmRemovalText: "<i18n:text catalogue="core" key="Tag.confirmRemoval"/>",
                                confirmRemoval: true,
                                continuousOutputBuild: true
                                });


                                });
                            </script>-->
                            <!--
                                                                $("#tags").autocomplete({ source:'{% url tags %}',minChars: 2 ,
                            -->

                           <!-- <script type="text/javascript">
                                $(function() {
                                    var localJSON = [
                                    <jx:forEach items="${availableTags}" var="item">
                                        {"id": "${item.id}", "label": "${item.tag}", "value": "${item.tag}" },
                                    </jx:forEach>];

                                    $('#metaInfo.${rowIndex}.tag input.tag').tagedit({
                                        autocompleteOptions: {
                                            source: localJSON
                                        }
                                    });

                                });

                            </script>
-->


                            <label for="addTag" class="label">
                                <ft:widget-label id="addTag"/>
                            </label>
                            <!--aaa-->
                            <!--<div id="addTag">
                                <input type="text" name="tag[]" value="" class="tag"/>
                            </div>-->

                            <!--<div id="metaInfo.${rowIndex}.tag">
                                <ft:widget id="addTag">
                                    <fi:styling class="tag" name="tag[]" value="" style="font-size:20px; width:270px;"
                                                onChange="cocoon.forms.submitForm(this);"/>
                                </ft:widget>
                            </div>-->






                            <script type="text/javascript">
                            $(function() {

                            var availableTags = [
                            <jx:forEach items="${availableTags}" var="item">
                                '${item.tag}',
                            </jx:forEach>];

                                $("#myTags").tagit({
                                    availableTags: availableTags
                                });

                            });
                            </script>
                            <ft:repeater id="tagList">
                                <div class="tags_${rowLanguageCode}">
                                    <ul id="myTags" class="tagedit-list">
                                        <ft:repeater-rows>
                                            <li class="tagedit-listelement tagedit-listelement-old">
                                                <span dir="ltr">
                                                    ${repeater.getRow(repeaterLoop.index).getChild('tag').value}
                                                </span>
                                                <ft:widget id="id">

                                                </ft:widget>
                                                <ft:widget id="addTag">
                                                    <fi:styling class="tag" name="tag[]" type="hidden" onChange="cocoon.forms.submitForm(this);"/>
                                                </ft:widget>
                                                <ft:widget id="delete">
                                                    <!--<fi:styling type="link" role="button" class="ui-button ui-corner-all ui-icon ui-icon-closethick"/>-->
                                                    <!--tagedit-close-->
                                                    <fi:styling type="link"
                                                                class="tagedit-close ui-icon ui-icon-closethick"
                                                                title="Remove from list."/>
                                                </ft:widget>
                                            </li>
                                        </ft:repeater-rows>
                                    </ul>
                                </div>

                            </ft:repeater>







                            <!--Список тегов из базы-->
                            <!--<ft:widget id="tagId">
                                <fi:styling class="chzn-select" style="width:350px;"/>
                                <fi:selection-list>
                                    <fi:item value="">
                                        <fi:label>-</fi:label>
                                    </fi:item>
                                    <jx:forEach items="${availableTags}" var="tag">
                                        <fi:item value="${tag.id}">
                                            <fi:label>${tag.tag}</fi:label>
                                        </fi:item>
                                    </jx:forEach>
                                </fi:selection-list>
                            </ft:widget>
                            <script>
                                $(".chzn-select").chosen();
                            </script>-->

                            <!--<ft:repeater id="tagList">
                                <div class="tags_${rowLanguageCode}">
                                    <ul class="tagedit-list">
                                        <ft:repeater-rows>
                                            <li class="tagedit-listelement tagedit-listelement-old">
                                                <span dir="ltr">
                                                    ${repeater.getRow(repeaterLoop.index).getChild('tag').value}
                                                </span>
                                                <ft:widget id="id">

                                                </ft:widget>
                                                <ft:widget id="tag">
                                                    <fi:styling class="tag" name="tag[]" type="hidden"/>
                                                </ft:widget>
                                                <ft:widget id="delete">
                                                    &lt;!&ndash;<fi:styling type="link" role="button" class="ui-button ui-corner-all ui-icon ui-icon-closethick"/>&ndash;&gt;
                                                    &lt;!&ndash;tagedit-close&ndash;&gt;
                                                    <fi:styling type="link"
                                                                class="tagedit-close ui-icon ui-icon-closethick"
                                                                title="Remove from list."/>
                                                </ft:widget>
                                            </li>
                                        </ft:repeater-rows>
                                    </ul>
                                </div>

                            </ft:repeater>-->
                        </li>
                    </ul>
                </div>
                <!--</ft:group>-->
            </ft:repeater-rows>
        </ft:repeater>

    </jx:macro>


    <jx:macro name="tags">
        <!--Ptags-->

        <!--<script type="text/javascript"
                src="/ems/resource/js/jquery-plugin/ptags/jquery.ptags.min.js"/>
        <link rel="stylesheet" type="text/css"
              href="/ems/resource/js/jquery-plugin/ptags/jquery.ptags.default.css"
              media="all"/>-->

        <!--Tag editor-->

        <script type="text/javascript"
                src="/ems/resource/js/jquery-plugin/tagedit/js/jquery.tagedit.js"/>
        <script type="text/javascript"
                src="/ems/resource/js/jquery-plugin/tagedit/js/jquery.autoGrowInput.js"/>
        <link rel="stylesheet" type="text/css"
              href="/ems/resource/js/jquery-plugin/tagedit/css/jquery.tagedit.css"
              media="all"/>
        <!--<script type="text/javascript"
                src="/ems/resource/js/jquery-plugin/tagedit/js/jquery-ui-1.8.6.custom.min.js"/>-->
        <!--<link rel="stylesheet" type="text/css"
              href="/ems/resource/js/jquery-plugin/tagedit/css/ui-lightness/jquery-ui-1.8.6.custom.css"
              media="all"/>-->


        <!--Tag It-->

        <script type="text/javascript"
                src="/ems/resource/js/jquery-plugin/tagit/js/tag-it.min.js"/>
        <link rel="stylesheet" type="text/css"
              href="/ems/resource/js/jquery-plugin/tagit/css/jquery.tagit.css"
              media="all"/>




    </jx:macro>
    <jx:macro name="lables">
        <!--<a href="#" id="labelsLink2" i18n:attr="title" title="ems:common.labels"
           onclick="hideLabelsDialog()">
            <i18n:text catalogue="ems" key="common.close"/>CLOSE
        </a>-->
        <ft:repeater id="labels">
            <!--<jx:if test="${actionState == 'create'}">
                <div style="display:none">
            </jx:if>-->
            <!-- <script type="text/javascript">

                jQuery(function() {
                &lt;!&ndash;accodrion &ndash;&gt;
                jQuery( "#accordion-translation" ).accordion({autoHeight: false,
                navigation: true});
                });
            </script>-->
            <!--<div id="accordion-translation">-->
            <!--class="widget-black"-->
            <jx:choose>
                <jx:when test="${repeater.getSize() == 0}">
                    <br/>
                    <em>LABLES: There is no data to display</em>
                </jx:when>
                <jx:otherwise>
                    <ft:repeater-rows>
                        <jx:set var="rowLanguageCode"
                                value="${repeater.getRow(repeaterLoop.index).getChild('languageCode').value}"/>
                        <!--<ft:group id="metaInfo">-->
                        <!--      <h3 position="${repeaterLoop.index % 2}" style="padding-left:30px">
                            ${widget.lookupWidget('languageCode').value} :
                            ${widget.lookupWidget('languageName').value}
                        </h3>-->
                        <!--forms-row-${repeaterLoop.index % 2}-->
                        <div class="meta-info" name="translate_${rowLanguageCode}">
                            <jx:attribute name="style">
                                <jx:choose>
                                    <!--<jx:when test="${rowLanguageCode == formLocale}">-->
                                    <jx:when test="${rowLanguageCode == languageCode}">
                                        display:block;
                                    </jx:when>
                                    <jx:otherwise>
                                        display:none;
                                    </jx:otherwise>
                                </jx:choose>
                            </jx:attribute>

                            <!--<ft:widget id="id">
                                <fi:styling type="hidden"/>
                            </ft:widget>-->
                            <ft:widget id="languageCode">
                                <fi:styling type="hidden"/>
                            </ft:widget>
                            <ft:widget id="objectId">
                                <fi:styling type="hidden"/>
                            </ft:widget>
                            <label for="label" class="label">
                                <ft:widget-label id="label"/>

                            </label>
                            <ft:widget id="label">
                                <fi:styling size="50" style="font-size:23px;"/>
                            </ft:widget>

                        </div>
                    </ft:repeater-rows>

                </jx:otherwise>
            </jx:choose>
            <!--</div>-->
        </ft:repeater>
    </jx:macro>

    <jx:macro name="linked">
        <ft:repeater id="linked">
            <table border="0" class="order">
                <tbody>
                    <ft:repeater-rows>
                        <tr class="forms-row">
                            <td>
                                <jx:set var="linkId"
                                        value="${repeater.getRow(repeaterLoop.index).getChild('id').value}"/>

                                <jx:set var="linkName"
                                        value="${repeater.getRow(repeaterLoop.index).getChild('name').value}"/>
                                <jx:set var="linkDate"
                                        value="${repeater.getRow(repeaterLoop.index).getChild('publishDateTime').value}"/>
                                <!--<ft:widget id="id"/>-->
                            </td>
                            <td>
                                <span class="label">
                                    <a>
                                        <jx:attribute name="href">/ems/core/Content-edit?id=${linkId}</jx:attribute>
                                        ${linkName}
                                    </a>
                                </span>
                            </td>
                            <td>
                                <span class="label">
                                    ${linkDate}
                                </span>
                            </td>
                            <td>
                                <ft:widget id="delete">
                                    <fi:styling type="link" role="button"
                                                class="ui-button ui-corner-all ui-icon ui-icon-closethick"/>
                                </ft:widget>
                            </td>
                        </tr>
                    </ft:repeater-rows>
                </tbody>
            </table>
        </ft:repeater>


    </jx:macro>

</jx:template>